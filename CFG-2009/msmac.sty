%  msmac.sty : macro definitions for documents
\typeout{msmac : Aug. 2, 1996}
%	originally contained in ms.sty
%	with additional macros taken from those posted to comp.text.tex
%	and fj.comp.texhax collected by T. Sato (tsato@kuee.kyoto-u.ac.jp)
%	macros without author name(s) are written by T. Sato
%  environments available now:
%	rightbox, llist, labellist, lablist, {left|right}{table|figure}
%       supertabular, subequations, includeversion, excludeversion, comment
%  commands available now:
%	\Jtoday, \ls{x}, \yen, \yubin, \makepageeven, \makepageodd, \rubi,
%       \inputif, \pagenum, \degree, \mylabel, \myref, \fullsize, \nospace,
%	\flushleftlabels, \flushrightlabels, \setlist, \cpbox, \maru,
%       \nagamaru, \xybox, \kspread, \kkspread, \rightrule, \lsx{x},
%       \slashbox, \backslashbox, \Sloppy, \Number, \setgenkou,
%	\Obeyspaces, \Obeylines, \smaller, \larger
%       \underl, \juline, \bigfirstletter, \pmb, \timeofday, \verbfile,
%       \listing, \simge, \simle, \spreadtitle, \shadowbox, \doublebox
%	\need, \therefore
%==============================================================================
%   for non-Japanese-TeX users: Only several commands at the top of this file
% contain Japanese characters, and can safely be deleted without affecting
% the rest of definitions.
%==============================================================================
% \Jtoday : same as \today in ms.sty used with [J] option
\def\Jtoday{
\ifnum\year=1989 平成元年\else%
\ifnum\year<1989\count99=\year\advance\count99 -1925 昭和\else%
\count99=\year\advance\count99 -1988 平成\fi\,\number\count99\,年\fi
\hspace{.5em}\nobreak\number\month\,月\hspace{.5em}\nobreak\number\day\,日}
%==============================================================================
% \kana, \Kana, \iroha, and \Iroha      (Feb. 7, 1992)
%  same as \alph or \Alph, but produce Japanese alphabets
%    \kana:  ア、イ、ウ、・・・
%    \Kana:  あ、い、う、・・・
%    \iroha: イ、ロ、ハ、・・・
%    \Iroha: い、ろ、は、・・・
% Usage:   \kana{counter} etc.
% Example: \def\theenumi{\Iroha{enumi}}
%=============================================
\def\kana#1{\@kana{\@nameuse{c@#1}}}
\def\@kana#1{\ifcase#1\or ア\or イ\or ウ\or エ\or オ\or
カ\or キ\or ク\or ケ\or コ\or サ\or シ\or ス\or セ\or ソ\or
タ\or チ\or ツ\or テ\or ト\or ナ\or ニ\or ヌ\or ネ\or ノ\or
ハ\or ヒ\or フ\or ヘ\or ホ\or マ\or ミ\or ム\or メ\or モ\or
ヤ\or ユ\or ヨ\or ラ\or リ\or ル\or レ\or ロ\or ワ\or ヲ\or ン\else\@ctrerr\fi}
\def\Kana#1{\@Kana{\@nameuse{c@#1}}}
\def\@Kana#1{\ifcase#1\or あ\or い\or う\or え\or お\or 
か\or き\or く\or け\or こ\or さ\or し\or す\or せ\or そ\or 
た\or ち\or つ\or て\or と\or な\or に\or ぬ\or ね\or の\or 
は\or ひ\or ふ\or へ\or ほ\or ま\or み\or む\or め\or も\or 
や\or ゆ\or よ\or ら\or り\or る\or れ\or ろ\or わ\or を\or ん\else\@ctrerr\fi}
\def\iroha#1{\@iroha{\@nameuse{c@#1}}}
\def\@iroha#1{\ifcase#1\or イ\or ロ\or ハ\or ニ\or ホ\or 
ヘ\or ト\or チ\or リ\or ヌ\or ル\or ヲ\or ワ\or カ\or ヨ\or 
タ\or レ\or ソ\or ツ\or ネ\or ナ\or ラ\or ム\or ウ\or ヰ\or 
ノ\or オ\or ク\or ヤ\or マ\or ケ\or フ\or コ\or エ\or テ\or 
ア\or サ\or キ\or ユ\or メ\or ミ\or シ\or ヱ\or ヒ\or モ\or 
セ\or ス\or ン\else\@ctrerr\fi}
\def\Iroha#1{\@Iroha{\@nameuse{c@#1}}}
\def\@Iroha#1{\ifcase#1\or い\or ろ\or は\or に\or ほ\or 
へ\or と\or ち\or り\or ぬ\or る\or を\or わ\or か\or よ\or 
た\or れ\or そ\or つ\or ね\or な\or ら\or む\or う\or ゐ\or 
の\or お\or く\or や\or ま\or け\or ふ\or こ\or え\or て\or 
あ\or さ\or き\or ゆ\or め\or み\or し\or ゑ\or ひ\or も\or 
せ\or す\or ん\else\@ctrerr\fi}
%==============================================================================
% *** Rest of this file does not contain Japanese characters ***
%==============================================================================
% \ls{x} : set line space to be x times the default (modified June 11, 1991)
%          same as \renewcommand{baselinestretch}{ x } , but effective
%          also in the text. (cf: \lsx, \lsxcur)
%          If two or more \ls is used in a paragraph, the last one is taken.
\let\@currsize=\normalsize
\def\ls#1{\let\@@curr=\@currsize\def\baselinestretch{#1}\large\@@curr}

% lsx{x} : set normal line space of all font sizes to be 'x'
%          (a dimension, e.g., 10mm, 5pt). cf: \lsxcur
%    Note: only \baselineskip is changed. Real line space is affected
%          by the glue. Use \raggedbottom for a more accurate spacings.
%  May 13, 1993
\let\@@setsize=\@setsize
\def\lsx#1{\def\@setsize##1##2{\@@setsize##1{#1}}\ls{1.0}}

% lsxcur{x} : set normal line space of the current font to be 'x'
%          (a dimension, e.g., 10mm, 5pt). If you change the font size
%          after this command, the line space will change proportionally.
%          cf: \lsx
%  May 11, 1993
\def\lsxcur#1{\@tempdima=#1\relax\@tempcnta=\@tempdima\relax
\ls{1.0}% reset baselinestretch to get original normalbaselineskip
\@tempcntb=\normalbaselineskip\relax  % in sp unit
\divide\@tempcntb by 1000  % three digit is optimum
\divide\@tempcnta by \@tempcntb\relax
\@tempcntb=\@tempcnta
\divide\@tempcnta by 1000
\multiply\@tempcnta by 1000
\advance\@tempcntb by -\@tempcnta
\divide\@tempcnta by 1000
\ifnum\@tempcntb > 99 \edef\@@stretch{\number\@tempcnta.\number\@tempcntb}\else
\ifnum\@tempcntb > 9 \edef\@@stretch{\number\@tempcnta.0\number\@tempcntb}\else
\edef\@@stretch{\number\@tempcnta.00\number\@tempcntb}\fi\fi%
\ls{\@@stretch}}

% \inputif : same as \input, but read a file only when it exists.
\def\inputif#1{
\openin6=#1
\ifeof6\else\closein6\input #1\fi
}

% mbf command : produce boldmath (bold and slanted) character(s)
\def\mbf#1{\mbox{\protect\boldmath$#1$}}

% \rubi : put furigana on a string. 　Usage: \rubi{furigana}{kanji}
\def\rubi#1#2{$\stackrel{\mbox{\scriptsize #1}}{\mbox{#2}}$}

% \yen : yen mark (taken from ascmac.sty for jlatex)
\def\yen{{\setbox99=\hbox{Y}Y\kern-.97\wd99\vbox{\hrule height.1ex
width.98\wd99\kern.33ex\hrule height.1ex width.98\wd99\kern.45ex}}}

% \yubin : 'yubin-bango' symbol    modified Feb. 13, 1991
\def\yubin{\leavevmode{\setbox99=\hbox{T}\hbox to 1.06\wd99{\hfil\vbox{\hrule
height.08\ht99 width.87\wd99 \kern.22\ht99\hrule height.08\ht99 width.87\wd99
\hbox to .87\wd99{\hfil\vrule height.6\ht99 width.1\wd99\hfil}}\hfil}}}

% \degree : 'degree' symbol
\def\degree{\mbox{$^\circ$}}

% makepageeven : increment page No. by 1 if the current page No. is odd
\long\def\makepageeven{
 \ifodd\count0\advance\count0 by 1\fi
}

% makepageodd : increment page No. by 1 if the current page No. is even
\long\def\makepageodd{
 \ifodd\count0\else\advance\count0 by 1\fi
}

% \pagenum{x} : set the number of page which contains this command to be x.
\def\pagenum#1{\setcounter{page}{#1}}

% rightbox environment: flushright group of lines left-aligned
\def\rightbox{\begin{flushright}\begin{tabular}{l@{}}}
\def\endrightbox{\end{tabular}\end{flushright}}

% llist environment: same as list except that labels are left-aligned
% see also: \flushleftlabels
\def\llist#1#2{\begin{list}{#1}{\def\makelabel##1{##1\hfil}#2}}
\def\endllist{\end{list}}


%=======================================================================
% labellist environment: similar to 'description', but text is aligned
%    after the width of the first argument (usually the longest label)
%    labels are left aligned
% Usage:
%  \begin{labellist}{longest-label}
%  \item[label] text
%   ...
%  \end{labellist}
% See also: lablist
\def\labellist#1{
 \begin{list}{}{\def\makelabel##1{##1\hfil}
 \settowidth{\labelwidth}{#1}
 \setlength{\labelsep}{1em}
 \setlength{\leftmargin}{\labelwidth}
 \addtolength{\leftmargin}{2\labelsep}} % labelsep both sides of label
}
\def\endlabellist{\end{list}}

%=======================================================================
% lablist : labellist with automatic adjustment for maximum labelwidth
%   Usage:
%     \begin{lablist}
%     \item[label] text ...
%     ...
%     \end{lablist}
%   Note: <<needs to run LaTeX twice>>
%     If there are two or more lablist environments in the same
%     document, the labelwidth is changed to fit the longest
%     label in each environment by the default. If a \commonlabel
%     command is issued, the longest label among all of the following
%     environments is used in common to determine the labelwidth until
%     a \nocommonlabel command appears.
%=======================================================================
\newdimen\lab@labelwidth
\lab@labelwidth=0pt
\newcount\lab@count
\lab@count=1
\newif\iflab@no
\let\iflab@no=\iftrue\relax

\def\commonlabel{\let\iflab@no=\iffalse\relax\global\lab@labelwidth=0pt}
\def\nocommonlabel{\let\iflab@no=\iftrue\relax\global\advance\lab@count by 1}

\def\lablist{
 \let\@orgitem=\item\relax
 \def\item{\@ifnextchar [{\@labitem}{\@noitemargtrue \@labitem[\@itemlabel]}}
 \begin{list}{}{\def\makelabel##1{##1\hfil}
 \iflab@no\lab@labelwidth=0pt\fi
 \@ifundefined{lab@\@roman{\lab@count}}%
  {\setlength{\labelwidth}{2.5em}}% labelwidth for the first pass
  {\setlength{\labelwidth}{\csname lab@\@roman{\lab@count}\endcsname}}
 \setlength{\labelsep}{1em}
 \setlength{\leftmargin}{\labelwidth}
 \addtolength{\leftmargin}{2\labelsep}} % labelsep both sides of label
}

\def\@labitem[#1]{\labitem{#1}}
\def\labitem#1{\settowidth{\@tempdima}{#1}\ifdim\@tempdima>\lab@labelwidth
\global\lab@labelwidth=\@tempdima\fi\@item[#1]}

\def\endlablist{\if@filesw
 \immediate\write\@auxout{\string\@lablist{lab@\@roman{\lab@count}}%
  {\the\lab@labelwidth}}\fi
 \iflab@no\global\advance\lab@count by 1\fi
 \end{list}
 \let\item=\@orgitem\relax
}
\def\@lablist#1#2{\global\@namedef{#1}{#2}}

%===========================================================================
%  \mylabel/\myref: personal cross reference
%                      by Toru Sato (tsato@kuee.kyoto-u.ac.jp)
%    \mylabel and \myref is similar to \label and \ref, but allows to refer
%  to any string (label) instead of 'the most-recently-updated counter'.
%  modified from \thebibliography in LaTeX.
%    Format:
%      \mylabel{name}{label}
%      \myref{name}
%    Example:
%      This is \myref{ref1}. 
%        ...
%      Here is definition \mylabel{ref1}{example}
%
%     -->  This is example.
%  It works just the same as \def\name{label} and \name, except that definition
%  may appear after reference, since it uses *.aux file as \label and \ref do.
%  Of course, you have to run the text twice.
%  The label can be anything; \mylabel{name}{\arabic{page}} does the same thing
%  as \pageref does, for example.  You can create your own cross-reference with
%  the help of \newcounter, \setcounter, \addtocounter, \arabic, \roman, etc.
%
\let\@myref\@gobble
\def\myref#1{\if@filesw
\immediate\write\@auxout{\string\@myref{#1}}\fi\ignorespaces
  \def\@citea{}\@for\@citeb:=#1\do
    {\@citea\def\@citea{,\penalty\@m\ }\@ifundefined
       {m@\@citeb}{{\bf ?}\@warning
       {Myref to `\@citeb' on page \thepage \space undefined}}%
\hbox{\csname m@\@citeb\endcsname}}%
}
\def\@mylabel#1#2{\global\@namedef{m@#1}{#2}}
\def\mylabel#1#2{\if@filesw
\immediate\write\@auxout{\string\@mylabel{#1}{#2}}\fi\ignorespaces
}

% \fullsize{margin} : declare to use entire A4 paper leaving 'margin' at
%                     four sides without header, footer or page number.
%                     to be used in the preamble.
%           margin  : some dimension. ex.: 15mm, 0.2in; must be positive.
% \fullsize[XX]{margin} : is for XX paper size (XX=A5,B5,A4,B4,A3)
\def\@Av{A5}
\def\@AvL{A5L}
\def\@Bv{B5}
\def\@BvL{B5L}
\def\@Aiv{A4}
\def\@AivL{A4L}
\def\@Biv{B4}
\def\@BivL{B4L}
\def\@Aiii{A3}
\def\@AiiiL{A3L}
%
\def\fullsize{\@ifnextchar [{\@fullsize}{\@fullsize[\@Aiv]}}
\def\@fullsize[#1]#2{
\edef\@tempa{#1}
\ifx\@tempa\@Av
 \textheight=210mm
 \textwidth=148mm
\else\ifx\@tempa\@AvL
 \textheight=148mm
 \textwidth=210mm
\else\ifx\@tempa\@Bv
 \textheight=257mm
 \textwidth=182mm
\else\ifx\@tempa\@BvL
 \textheight=182mm
 \textwidth=257mm
\else\ifx\@tempa\@AivL
 \textheight=210mm
 \textwidth=296mm
\else\ifx\@tempa\@Biv
 \textheight=364mm
 \textwidth=257mm
\else\ifx\@tempa\@BivL
 \textheight=257mm
 \textwidth=364mm
\else\ifx\@tempa\@Aiii
 \textheight=420mm
 \textwidth=296mm
\else\ifx\@tempa\@AiiiL
 \textheight=296mm
 \textwidth=420mm
\else % default=A4
 \ifx\@tempa\@Aiv\else\message{!! Unknown paper size <\@tempa>: set to A4}\fi
 \textheight=296mm
 \textwidth=210mm
\fi\fi\fi\fi\fi\fi\fi\fi\fi
\topmargin=-25.4mm
\advance\topmargin#2
\advance\textheight-#2
\advance\textheight-#2
\headheight=0pt
\headsep=0pt
\oddsidemargin=-25.4mm
\advance\oddsidemargin#2
\advance\textwidth-#2
\advance\textwidth-#2
\footheight=0pt
\footskip=0pt
\pagestyle{empty}
}

% \nospace : set \topsep, \itemsep, and \partopsep to zero, so that
%            no space is inserted between items in any list environments.
%            Should be used right before \begin{itemize} etc.
%            The effect is reset by \small, \normalsize etc.
\def\nospace{
\def\@listi{\leftmargin\leftmargini\topsep 0pt\itemsep 0pt\parsep 0pt
\partopsep 0pt}
\def\@listii{\leftmargin\leftmarginii\topsep 0pt\itemsep 0pt\parsep 0pt
\partopsep 0pt}
\def\@listiii{\leftmargin\leftmarginiii\topsep 0pt\itemsep 0pt\parsep 0pt
\partopsep 0pt}
}

% \setlist : add extra setup commands to a list environment which follows.
%            should be useful in changing style of itemize and enumerate.
%            (June 10, 1991)
%      Ex.:    \setlist{\leftmargin 10mm \labelsep 3mm}
%              \begin{enumerate}
%               ...
%      Bug.: affects all list environments of the same nesting level.
%            font-size changing command resets the effect. Also can be reset
%            by \setlist{}.
\newcount\@@listdepth
\def\setlist#1{
\@@listdepth=\@listdepth
\advance\@@listdepth\@ne
\@namedef{@list\romannumeral\the\@@listdepth}{#1}
}

% \flushleftlabels and \fulshrightlabels
%   declares that all list environments including itemize and enumerate
%   should flushleft or flushright their labels (default is flushright).
%   (June 10, 1991)

\def\flushleftlabels{
\def\@mklab##1{##1 \hfil}
\def\enumerate{\ifnum \@enumdepth >3 \@toodeep\else
      \advance\@enumdepth \@ne 
      \edef\@enumctr{enum\romannumeral\the\@enumdepth}\list
      {\csname label\@enumctr\endcsname}{\usecounter
        {\@enumctr}\def\makelabel####1{####1 \hfil}}\fi}
\def\itemize{\ifnum \@itemdepth >3 \@toodeep\else \advance\@itemdepth \@ne
\edef\@itemitem{labelitem\romannumeral\the\@itemdepth}%
\list{\csname\@itemitem\endcsname}{\def\makelabel####1{####1 \hfil}}\fi}
}

\def\flushrightlabels{
\def\@mklab##1{\hfil ##1}
\def\enumerate{\ifnum \@enumdepth >3 \@toodeep\else
      \advance\@enumdepth \@ne 
      \edef\@enumctr{enum\romannumeral\the\@enumdepth}\list
      {\csname label\@enumctr\endcsname}{\usecounter
        {\@enumctr}\def\makelabel####1{\hss\llap{####1}}}\fi}
\def\itemize{\ifnum \@itemdepth >3 \@toodeep\else \advance\@itemdepth \@ne
\edef\@itemitem{labelitem\romannumeral\the\@itemdepth}%
\list{\csname\@itemitem\endcsname}{\def\makelabel####1{\hss\llap{####1}}}\fi}
}

%=============================================================================
% leftfigure, rightfigure, lefttable, righttable : produces a 'cut' at the
% right or left in the text.
%   by tsato@kuee.kyoto-u.ac.jp (Toru Sato)      October 9, 1991
%      Department of Electrical Engineering II, Kyoto University
%      Kyoto 606-01, Japan
%
%   Usage:  \begin{leftfigure}{<width>}{<lines>}[<toplines>]
%             <figure body>
%           \end{leftfigure}
%           <paragraph>
%           <blank line>
%   Explanation:
%         The leftfigure produces a blank space of <width> x <lines> by
%         cutting the left of the text after <toplines>(optional) from
%         the top of <paragraph>, and puts <figure body> in the space.
%         <width> should have the unit of length (cm, in, pt) and <lines>
%         and <toplines> should be an integer.
%            The vertical size of the <figure body> should be specified
%         independently by \vspace command etc.  It simply overlaps with
%         the following text if the <lines> is too small.
%            A space of width \lfsep is put at both sides of the <figure
%         body>, whose width thus becomes <width>-2\lfsep.  The default
%         value of \lfsep is '3ex', but you can change it like other
%         dimensions.
%            There are rightfigure, lefttable, and righttable environments
%         which do the corresponding jobs.
%   Example:
%         ...preceding text...
%                            <- a blank line or the \section etc.
%         \begin{leftfigure}{60mm}{12}[3]
%         \vspace{35mm}
%         \caption{This is a figure.}
%         \end{leftfigure}   <- here should not be a blank line!
%         The width of the 12 lines after the three first lines of this
%         paragraph is reduced by 60mm, and the figure is placed in the
%         extra space produced at the left end of the text area.
%         If the text in this paragraph is not long enough to cover the height
%         of the figure, use
%         \Par
%         Command to connect the next paragraph.
%         ...more text...
%                            <- here should be a blank line!
%   Limitations:
%      1) These environments must be placed at the top of a paragraph, and
%         their effect is limited inside the paragraph (so you should not
%         put a blank line after \end{left|rightfigure}). Connect following
%         paragraph(s) by \Par command in place of a blank line, if it is
%         necessary. Naturally, one paragraph can contain only one of
%         {left|right}{figure|table}.
%      2) They cannnot handle the end-of-page problem. You have to put them
%         at the right place so that all lines are contained in one page.
%      3) The paragraph that begins with these environments should end
%         explicitly with a blank line.  This is particularly important when
%         the paragraph is the last one of the document, section, subsection,
%         etc.
%      4) You can specify the vertical size only by the number of lines.
%         The vertical extent of the space is therefore slightly variable
%         due to the interline glue put by TeX.  Although the paragraph may
%         contain equations, each displayed equation should be counted as 3
%         lines.
%      5) Ordinary \caption command can be used for a caption, and numbering
%         is made properly. It is possible to mix these environments with
%         ordinary figures and/or tables, but there is no guarantee that the
%         order of the figures is kept right.
%=============================================================================
\newdimen\lfsep
\lfsep=3ex       % separation between the figure/table and text/margin
%=============================================================================
\def\leftfigure#1#2{
\@ifnextchar [{\@leftcut{figure}{#1}{#2}}{\@leftcut{figure}{#1}{#2}[0]}}
\def\@leftcut#1#2#3[#4]{\makeblank{#2}{#3}{#2}{#4}
\@nltop=#4 \ifnum\@nltop>0 \begin{nullfloat}{#1}{#2}{0pt}{#4}
\else \begin{nullfloat}{#1}{#2}{-#2}{#4} \fi}
% Next \def puts the following paragraph BEFORE the closing procedure,
% but this trick invoked the limitation 3).
\def\endleftfigure#1 #2\par{\end{nullfloat}#2\par#1}

\def\rightfigure#1#2{
\@ifnextchar [{\@rightcut{figure}{#1}{#2}}{\@rightcut{figure}{#1}{#2}[0]}}
\def\@rightcut#1#2#3[#4]{\makeblank{#2}{#3}{0pt}{#4}
\@parwd=\columnwidth \advance \@parwd by -#2
\begin{nullfloat}{#1}{#2}{\@parwd}{#4}}
\let\endrightfigure=\endleftfigure

\def\lefttable#1#2{
\@ifnextchar [{\@leftcut{table}{#1}{#2}}{\@leftcut{table}{#1}{#2}[0]}}
\let\endlefttable=\endleftfigure

\def\righttable#1#2{
\@ifnextchar [{\@rightcut{table}{#1}{#2}}{\@rightcut{table}{#1}{#2}[0]}}
\let\endrighttable=\endleftfigure

%=============================================================================
% nullfloat : produces a table or a figure whose size is 0pt x 0pt
\def\nullfloat#1#2#3#4{\def\@captype{#1}
 % #1=figure|table #2=width #3=indent #4=toplines
\noindent\hbox to 0pt \bgroup \hskip\lfsep\hskip #3
\vbox to 0pt \bgroup \vskip #4\baselineskip\hsize #2 \advance\hsize -2\lfsep
\textwidth\hsize\columnwidth\hsize \@parboxrestore}
\def\endnullfloat{\vss\egroup\hss\egroup\vskip-\baselineskip}

% makeblank : makes a blank space at the right or left of text
\newdimen\@parwd \newcount\@nlp \newcount\@nlpi \newcount\@nltop
\def\rightblank#1#2{\makeblank{#1}{#2}{0pt}{0}}
\def\leftblank#1#2{\makeblank{#1}{#2}{#1}{0}}
\def\makeblank#1#2#3#4{ % #1=width #2=lines #3=indent #4=toplines
\@parwd=\columnwidth \advance \@parwd by -#1
\@nlpi=#2 \advance \@nlpi by 1
\@nltop=#4 \advance \@nlpi by \@nltop
\edef\@PS{\parshape=\@nlpi}
\@nlp=0 \ifnum\@nltop>0
\loop\ifnum\@nlp<\@nltop\advance\@nlp by 1
 \edef\@PS{\@PS 0pt\columnwidth}\repeat
\fi \advance\@nlp by 1
\loop\ifnum\@nlp<\@nlpi\advance\@nlp by 1 \edef\@PS{\@PS #3\@parwd}\repeat
\edef\@PS{\@PS 0pt\columnwidth} \@PS}
\def\Par{\\[\parskip]\hspace*{\parindent}}

%=============================================================================
% cpbox: same as parbox, but centering the contents if the text is narrower
%	than the width. May be useful in producing mail labels.
%	usage: \cpbox{width}{text}
%	limitation: font size change command should not be used in \cpbox
\def\cpbox#1#2{
\setbox\@tempboxa\hbox{\begin{tabular}{@{}l@{}}#2\end{tabular}}%
\ifdim\wd\@tempboxa>#1
\parbox{#1}{#2}
\else
\hbox to #1 {\hfil\parbox{\wd\@tempboxa}{#2}\hfil}
\fi
}

%===================================
% \maru{x} : encircled character 'x'
\def\maru#1{{%
\raisebox{-.35zh}[1.15zh][0.45zh]{%
\setlength{\unitlength}{1zh}%
\begin{picture}(1.5,1.4)(0,0)
\put(0.75,0.7){\circle{1.4}}
\put(0.75,0.7){\makebox(0,0){#1}}
\end{picture}}%
}}

%===================================================================
% \nagamaru{xyz} : encircled string 'xyz'.  'xyz' can be a 'tabular'
%                  July 2, 1992
\newdimen\@nagax
\newdimen\@nagaxx
\newdimen\@nagay
\newdimen\@nagayy
\newdimen\@oldunitlength
\newbox\@nagabox
\def\nagamaru#1{{%
\setlength{\unitlength}{1sp}%
\setbox\@nagabox=\hbox{#1}%
\@nagax=\ht\@nagabox\advance\@nagax by 0.7zw%
\@nagay=\dp\@nagabox\advance\@nagay by 0.7zh%
\@nagayy=\dp\@nagabox\advance\@nagayy by 0.5zh% 
\raisebox{-1\@nagayy}[\@nagax][\@nagay]{%
\@nagax=\wd\@nagabox\advance\@nagax by 1zw%
\@nagay=\ht\@nagabox\advance\@nagay by \dp\@nagabox\advance\@nagay by 1zh%
\begin{picture}(\number\@nagax,\number\@nagay)(0,0)
\@nagaxx=\@nagax\divide\@nagaxx by 2%
\@nagayy=\@nagay\divide\@nagayy by 2%
\divide\@nagay by 131072 \multiply\@nagay by 131071 % omajinai
\put(\number\@nagaxx,\number\@nagayy){\oval(\number\@nagax,\number\@nagay)}
\put(\number\@nagaxx,\number\@nagayy){\makebox(0,0){#1}}
\end{picture}}%
}}

%====================================================================
% \xybox{x-shift}{y-shift}[pos]{text}     Mar 2, 1992
% put 'text' in a box with zero-size, at (x-shift,y-shift)
% from the current position. Optional 'pos' has the same meaning
% as that of the \makebox command in the picture environment.
% 
% Ex.: A\xybox{3mm}{-4mm}[tr]{X}B
%    puts an X whose top-right corner is (3mm,-4mm) measured from
%    bottom-center of 'A' and 'B' with no extra space between them.
%
\def\xybox#1#2{\leavevmode\@ifnextchar 
   [{\@xybox{#1}{#2}}{\@xybox{#1}{#2}[]}}

\long\def\@xybox#1#2[#3]#4{\setbox\@tempboxa=\hbox to0pt{\kern #1
\raise #2\vbox to0pt{ % taken from \makebox in latex.tex
    \let\mb@b\vss \let\mb@l\hss \let\mb@r\hss \let\mb@t\vss
    \@tfor\@tempa :=#3\do{\expandafter\let
        \csname mb@\@tempa\endcsname\relax}%
\mb@t\hbox to0pt{\mb@l #4\mb@r}\mb@b}\hss}%
\ht\@tempboxa0pt\dp\@tempboxa0pt\box\@tempboxa}

%===========================================================================
% kspread{width}{kanji-text} : spread 'kanji-text' to 'width'
%    'kanji-text' may contain hankaku-chars, but space is not inserted
%    between hankaku-chars. If there is no kanji-space, the text is just
%    centered at the 'width'.
\def\kspread#1#2{%
\setbox\@tempboxa=\hbox{\kanjiskip1sp\xkanjiskip1sp\ignorespaces #2}%
\@tempcnta=\wd\@tempboxa%
\setbox\@tempboxa=\hbox{\kanjiskip0pt\xkanjiskip0pt\ignorespaces #2}%
\advance\@tempcnta by -\wd\@tempboxa%
\ifnum\@tempcnta=0 \@tempcnta=1\fi%  (No kanjiskip was found)
\@tempdima=#1\relax\advance\@tempdima by -\wd\@tempboxa%
\divide\@tempdima by \@tempcnta%
\makebox[#1]{\kanjiskip\@tempdima\xkanjiskip\@tempdima\ignorespaces #2}}

%===========================================================================
% kkspread{text1}{text2} : spread 'text2' to the natural width of 'text1'
\def\kkspread#1#2{\settowidth{\@tempdimb}{#1}\kspread{\@tempdimb}{#2}}

%===========================================================================
% \rightrule[total-width]{text}
% draw underline after <text> to make <total-width> including
% the width of the text. default for total-width is \textwidth.
%     text...text _______________________
%      <------------total-width---------->
% Ex.: \rightrule{Address:}  \rightrule[5cm]{Name:}
\newlength{\@llen}
\newlength{\@rlen}
\def\rightrule{\@ifnextchar [{\@rightrule}{\@rightrule[\textwidth]}}
\def\@rightrule[#1]#2{\settowidth{\@llen}{#2}%
\setlength{\@rlen}{#1}\addtolength{\@rlen}{-\@llen}%
\makebox[\@llen]{#2}\underline{\makebox[\@rlen]{}}}

%=====================================================================
% nohyphen : suppress hyphenation     1993/6/10
\def\nohyphen{\hyphenpenalty=10000 \exhyphenpenalty=10000}

%=====================================================================
% \Sloppy : alternative to \sloppy    1993/7/16
\def\Sloppy{%
\tolerance=1000
\spaceskip=.33em plus .67em
\xspaceskip=.5em plus .5em
\rightskip=0pt plus 2em
}

%=====================================================================
% \multivspace{vspace}{count}    1993/8/11
% put \vspace{vspace} 'count' times (count > 0)
\long\def\multivspace#1#2{\ifhmode\par\fi{\baselineskip=#1\relax
\@tempcnta=#2\relax\advance\@tempcnta \m@ne
\@whilenum\@tempcnta >\z@\do{\rule{0pt}{0pt}\hfil\break
\advance\@tempcnta \m@ne}\rule{0pt}{0pt}\hfil\par}
}

%=====================================================================
% slashbox.sty by Koichi Yasuoka, May 27, 1993
%              minor modification by Toru Sato, May 31, 1993
%  \[back]slashbox[width][spec]{l-item}{r-item}
%    width: entire width of the box
%    spec = l, r, lr (suppression of \tabcolsep on l, r, or both side)
%\typeout{slashbox style by K.Yasuoka, May 1993.}%
\newbox\@slashboxa
\newbox\@slashboxb
\newbox\@slashboxc
\newcount\@slashboxwd
\newcount\@slashboxht
\newdimen\@slashsepl
\newdimen\@slashsepr
\def\slashbox{%
  \def\@slashboxpicture##1{%
    \put(0,0){\line(##1,1){\@slashboxwd}}%
    \put(0,\@slashboxht){\makebox(0,0)[tl]{\box\@slashboxa}}%
    \put(\@slashboxwd,0){\makebox(0,0)[br]{\box\@slashboxb}}%
  }%
  \@slashbox
}%
\def\backslashbox{%
  \def\@slashboxpicture##1{%
    \put(0,\@slashboxht){\line(##1,-1){\@slashboxwd}}%
    \put(0,0){\makebox(0,0)[bl]{\box\@slashboxa}}%
    \put(\@slashboxwd,\@slashboxht){\makebox(0,0)[tr]{\box\@slashboxb}}%
  }%
  \@slashbox
}%
\def\@slashbox{\@ifnextchar [{\@@slashbox}{\@@slashbox[0pt]}}
\def\@@slashbox[#1]{\@ifnextchar [{\@@@slashbox[#1]}{\@@@slashbox[#1][c]}}
\def\@@@slashbox[#1][#2]#3#4{%
% #1: width, #2: suppression of \tabcolsep on `l', `r', or `lr' side
% #3: left item, #4: right item
  \@slashsepl=\tabcolsep
  \@slashsepr=\tabcolsep
    \@tfor\@tempa :=#2\do{\expandafter\let
        \csname @slashsep\@tempa\endcsname=\z@}%
  \setbox\@slashboxa=\hbox{\strut\hskip\tabcolsep\shortstack[l]{#3}}%
  \setbox\@slashboxb=\hbox{\shortstack[r]{#4}\hskip\tabcolsep\strut}%
  \setbox\@slashboxa=\hbox{\raise\dp\@slashboxa\box\@slashboxa}%
  \setbox\@slashboxb=\hbox{\raise\dp\@slashboxb\box\@slashboxb}%
  \setbox\@slashboxc=\hbox{%
    \@tempdima=\wd\@slashboxa
    \advance\@tempdima by \wd\@slashboxb
    \advance\@tempdima by \@slashsepl
    \advance\@tempdima by \@slashsepr
    \@tempdimb=#1\relax%
    \ifdim\@tempdimb>\@tempdima \@tempdima=\@tempdimb\fi%
    \@tempdimb=\ht\@slashboxa
    \advance\@tempdimb by \dp\@slashboxa
    \advance\@tempdimb by \ht\@slashboxb
    \advance\@tempdimb by \dp\@slashboxb
    \@tempcnta=\@tempdima
    \@tempcntb=\@tempdimb
    \advance\@tempcnta by \@tempcntb
    \advance\@tempcnta by -1
    \divide\@tempcnta by \@tempcntb
    \ifnum\@tempcnta>6 \@tempcnta=6
      \@tempdimb=0.166666666\@tempdima
    \else
      \ifnum\@tempcnta<1 \@tempcnta=1\fi
      \@tempdima=\@tempdimb
      \multiply\@tempdima by \@tempcnta
    \fi%
    \advance\@tempdima by -\@slashsepl
    \advance\@tempdima by -\@slashsepr
    \@slashboxwd=\@tempdima
    \@slashboxht=\@tempdimb
    \@tempcntb=\@slashsepl
    \setlength{\unitlength}{1sp}%
    \begin{picture}(\@slashboxwd,\@slashboxht)(\@tempcntb,0)
    \advance\@tempdima by \@slashsepl
    \advance\@tempdima by \@slashsepr
    \@slashboxwd=\@tempdima
    \@slashboxpicture{\@tempcnta}
    \end{picture}%
  }%
  $\vcenter{\box\@slashboxc}$%
}%
%------------------------------------------
% \SLASH{width}{height}
\newcount\@slashwd
\newcount\@slashht
\def\SLASH#1#2{{%
\setlength{\unitlength}{1sp}%
\@tempdima=#1\relax
\@tempdimb=#2\relax
\@tempcnta=\@tempdima
\@tempcntb=\@tempdimb
\@slashwd=\@tempcnta
\@slashht=\@tempcntb
\begin{picture}(\@slashwd,\@slashht)(0,0)
\divide\@tempcnta by \@tempcntb
\ifnum\@tempcnta>6 \@tempcnta=6
  \@tempdimb=0.166666666\@tempdima
\else
  \ifnum\@tempcnta<1 \@tempcnta=1\fi
  \@tempdima=\@tempdimb
  \multiply\@tempdima by \@tempcnta
\fi%
\put(0,0){\line(\@tempcnta,1){\@slashboxwd}}%
\end{picture}}}

%----------------------------------------------------
% \Number{number} : insert commas every three digits of 'number'
%   Ex.:  \Number{1234567}  -> 1,234,567
\def\Number#1{%
\@tempcnta=0\@tfor\@tempa :=#1\do{\advance\@tempcnta by 1}%
\@tfor\@tempa :=#1\do{\@tempa\advance\@tempcnta by -1
\ifnum\@tempcnta > 0%
\@tempcntb=\@tempcnta\divide\@tempcntb by 3\multiply\@tempcntb by 3
\advance\@tempcntb by -\@tempcnta
\ifnum\@tempcntb=0,\fi\fi}}

%-----------------------------------------------------
% \setgenkou{char}{line} : set char/line and line/page
%                          works only with ASCII-jLaTeX
\newskip\genkoubaseline
\def\setgenkou#1#2{ % #1=char/line, #2=line/page
 \@normalsize
 \@tempcnta=#1\relax\advance\@tempcnta by -1
 \@tempdima=\textwidth\advance\@tempdima by -1zw
 \divide\@tempdima by \@tempcnta
 \advance\@tempdima by -1zw
 \kanjiskip=\@tempdima plus .05zw minus .05zw
 \xkanjiskip=\kanjiskip
 \mathsurround=\kanjiskip
 \parindent=1zw\advance\parindent by \kanjiskip
 \hfuzz=\parindent
 \advance\hfuzz by 1pt
%
 \@tempcntb=#2\relax\advance\@tempcntb by -1
 \@tempdimb=\textheight\advance\@tempdimb by -1zh
 \divide\@tempdimb by \@tempcntb
 \genkoubaseline=\@tempdimb plus 0.02zh minus 0.02zh
 \let\@@setsize=\@setsize
 \def\@setsize##1##2{\@@setsize##1{\genkoubaseline}}
 \def\baselinestretch{1}
 \large\@normalsize
} 

%===================================================================
% \Obeyspaces and \Obeylines         1994/8/16
%   \Obeyspaces: same as \obeyspaces, but makes blanks at the top of
%                a line effective
%   \Obeylines:  same as \obeylines, but makes blank lines effective
%===================================================================
{\catcode`\ =\active
\gdef\Obeyspaces{\catcode`\ =\active\let =\@xobeysp\obeyspaces}}
%\def\@xobeysp{\leavevmode\penalty10000\ } % defined in latex.tex
\def\Obeylines{\def\par{\leavevmode\endgraf}\obeylines}
%===================================================================
% \smaller: switches current font one-size smaller (\Large -> \large etc.)
\def\smaller{% 1994/1/4
 \ifx\@currsize\Huge\ifx\Huge\huge\LARGE\else\huge\fi\else%
 \ifx\@currsize\huge\LARGE\else%
 \ifx\@currsize\LARGE\Large\else%
 \ifx\@currsize\Large\large\else%
 \ifx\@currsize\large\normalsize\else%
 \ifx\@currsize\normalsize\small\else%
 \ifx\@currsize\small\footnotesize\else%
 \ifx\@currsize\footnotesize\scriptsize\else%
 \ifx\@currsize\scriptsize\tiny%
 \fi\fi\fi\fi\fi\fi\fi\fi\fi%
}
%===================================================================
% \larger: switches current font one-size larger (\large -> \Large etc.)
\def\larger{% 1994/1/4
 \ifx\@currsize\tiny\scriptsize\else%
 \ifx\@currsize\scriptsize\footnotesize\else%
 \ifx\@currsize\footnotesize\small\else%
 \ifx\@currsize\small\normalsize\else%
 \ifx\@currsize\normalsize\large\else%
 \ifx\@currsize\large\Large\else%
 \ifx\@currsize\Large\LARGE\else%
 \ifx\@currsize\LARGE\huge\else%
 \ifx\@currsize\huge\Huge%
 \fi\fi\fi\fi\fi\fi\fi\fi\fi%
}


%===========================================================================
%============= followings are from comp.text.tex ===========================
%===========================================================================
% supertab.sty 						-*-LaTeX-*-
%
% Originally by:
% 	Theo Jurriens 1988
% 	TAJ@hgrrug5        P.O Box 800, 9700 AV Groningen
%
% Description:
%	A LaTeX style file which creates a new environment "supertabular".
%	The new environment is similar to the normal LaTeX "tabular"
%	environment with the following differences:
%		The supertabular environment will wrap around pages.
%		A heading can be placed at the start of each page by using
%		\tablehead. 
%		Similarly, a footer can be placed at the end of each page
%		by using \tabletail.
%		If the figure starts on a non-blank page, then set the
%		counter \startline to be the number of lines already on the
%		page. 
%
% Example:
%	\documentstyle[supertab]{article}
%	\begin{document}
%	\tablehead{\hline
%	Ster&Harvardnr&max&periode&\multicolumn{3}{l|}{Datum}\\
%	\hline}
%	\tabletail{\hline}
%
%	\begin{supertabular}{|llrrrrc|}
%	SS Cas &000451 &  8.8&140.57&30&jan&1989\\
%	SS Cas &000451 &  8.8&140.57& 7&nov&1989\\
%	T And  &001726 &  7.7&280.76&10&aug&1989\\
%	.
%	.
%	.
%	RW Peg &225914 &  8.8&208.43&23&aug&1989\\
%	V Cas  &230759 &  6.9&228.83&18&feb&1989\\
%	W Peg  &231425 &  7.9&344.92&27&apr&1989\\
%	S Peg  &231508 &  7.1&319.22& 4&dec&1989\\
%	Z Peg  &235525 &  7.7&325.47&23&jun&1989\\
%	\end{supertabular}
%	\end{document}
%
% Fixes:
%	7/5/90	Tony Li tli@usc.edu
%	Reformatted code, added instructions.
%	Hacked so that \\ is now the normal line terminator.
%	Changed \\ so that it now generates a \par instead of a \clearpage.
%	Added another counter \startline which initializes \numline.  This
%	allows us to start a table on a page which already contains text.
%	\startline needs to estimate the number of lines already used on
%	the page.
%
\def\@tablehead{\ }
\def\tablehead#1{\gdef\@tablehead{#1}}
\def\@tabletail{\ }
\def\tabletail#1{\gdef\@tabletail{#1}}
\newcount\startline
\startline=0
\newcount\numline
\newcount\maxline
%
\def\calmaxline{\global\maxline=\textheight
	\global\divide\maxline by \baselineskip
}
%
\def\@supertab{	\def\@halignto{}\leavevmode \hbox \bgroup
	$\let\@acol\@tabacol \let\@classz\@tabclassz
	\let\@classiv\@tabclassiv \let\\=\@supertabcr\@tabarray}
\def\@endsupertab{\crcr\egroup\egroup $\egroup}
%
\newenvironment{supertabular}[1]{
	\edef\tableformat{\string#1} 
	\calmaxline
	\numline=\startline
	\@supertab{\tableformat}\@tablehead%
}%
{%
	\@tabletail \@endsupertab%
}%
%
%
\def\@supertabcr{\global\advance\numline by 1 \@tabularcr%
	\ifnum\numline=\maxline%
	        \@tabletail%
	        \@endsupertab%
		\par%
	        \global\numline=0%
        	\@supertab{\tableformat}%
	        \@tablehead%
	\fi%
}
\def\nextline{\\} % for compatibility with the old version (t.s.)
%
%=============================================================================
% subequations environment: changes the numbering from 1, 2, 3 to 4a, 4b, 4c.
%
% This style option is designed to work with LaTeX version 2.09.
% Copyright (c) 1990 by Stephen Gildea
% Permission to copy all or part of this work is granted, provided
% that the copies are not made or distributed for resale, and that
% the copyright notice and this notice are retained.
% 
% THIS WORK IS PROVIDED ON AN "AS IS" BASIS.  THE AUTHOR PROVIDES NO
% WARRANTY WHATSOEVER, EITHER EXPRESS OR IMPLIED, REGARDING THE WORK,
% INCLUDING WARRANTIES WITH RESPECT TO ITS MERCHANTABILITY OR FITNESS
% FOR ANY PARTICULAR PURPOSE.
%
% If you make any improvements, I'd like to hear about them.
%
% Stephen Gildea
% MIT Earth Resources Lab
% Cambridge, Mass. 02139
% mit-erl!gildea
% gildea@erl.mit.edu

% Original version by mit-erl!gildea August 1986.
% @ignoretrue fix from Johannes Braams <BRAAMS%HLSDNL5.BITNET> 16 Jan 89
% use refstepcounter from Rick Zaccone <zaccone@rigel.bucknell.edu> 13 Feb 90

% Within the subequations environment, the only change is that
% equations are labeled differently.  The number stays the same,
% and lower case letters are appended.  For example, if after doing
% three equations, numbered 1, 2, and 3, you start a subequations
% environmment and do three more equations, they will be numbered
% 4a, 4b, and 4c.  After you end the subequations environment, the
% next equation will be numbered 5.
%
% Both text and equations can be put inside the subequations environment.
%
% Of course, you can use this idea to create your own subfigures and
% subtables environments, too.

\newtoks\@stequation

\def\subequations{\refstepcounter{equation}%
  \edef\@savedequation{\the\c@equation}%
  \@stequation=\expandafter{\theequation}%   %only want \theequation
  \edef\@savedtheequation{\the\@stequation}% % expanded once
  \edef\oldtheequation{\theequation}%
  \setcounter{equation}{0}%
  \def\theequation{\oldtheequation\alph{equation}}}

\def\endsubequations{\setcounter{equation}{\@savedequation}%
  \@stequation=\expandafter{\@savedtheequation}%
  \edef\theequation{\the\@stequation}\global\@ignoretrue}

%=============================================================================
% \underl
%From: grunwald@foobar.colorado.edu (Dirk Grunwald)
%Newsgroups: comp.text.tex
%Date: 10 Jul 90 03:59:12 GMT
%Organization: University of Colorado at Boulder

%Actually, some one mailed me the underline code. A little hacking
%produces the following example. The original code was a little liberal
%with spaces in the code, which produces an extra space after each word
%in the underlined region. This version corrects that and gives a
%single underlined space between words.
%======
%>From: Damian.Cugley@prg.ox.ac.uk (Damian Cugley)
%But the "space" it gives is (a) rigid (defeating right-justification)
%and (b) doesn't dissappear at the margin.  I think you could usefully
%replace the \ulinebox{\space} with 
%\leaders\somesortofunderlinedbox\hskip\spaceskiporsimilar.
%======
% The following is my version, still under test (t.s.)

%% Usage is
%% \underl <underlined text> &
%% The space before "&" is important.

\newskip\iw@skip \iw@skip .333em plus .166em minus .111em
\def\underl#1 {\leavevmode\let\first=\relax\underli #1 }
\def\underli#1 {\ifx&#1\let\next=\relax\space
    \else\let\next=\underli\first\ulinebox{#1}\fi\let\first=\undersp\next}
\def\undersp{\penalty50\leaders\ulinebox{\hspace{.01em}}\hskip\iw@skip\penalty50}
\def\ulinebox#1{\vtop{\hbox{\strut#1}\hrule}}%Taken from TexHax v.88, 52

%=============================================================================
% Underline for Japanese Text
% by Hideki ISOZAKI Jan. 11 1988
% This underline is generated for each kanji character.
% You should enclose ASCII characters and commands in its argument.

%%\@ifundefined{jintercharskip}{\let\jintercharskip=\kanjiskip}{}
\newskip\wd@uline
\def\juline#1{\ul@one#1\endul@one}
\def\ul@one#1{\ifx#1\endul@one\def\u@line{\hskip\kanjiskip}\else%
\hskip\kanjiskip% insert glue
\settowidth{\wd@uline}{#1}%
#1\kern-\wd@uline\lower0.33em\hbox{\vrule width\wd@uline height0.05em}%
\let\u@line=\ul@one\fi\u@line}

%=============================================================================
% \bigfirstletter
%From: xiaofei@acsu.buffalo.edu (Xiaofei Wang)
%Newsgroups: comp.text.tex
%Subject: One big first letter using latex
%Date: 5 Sep 90 06:37:01 GMT
%Organization: SUNY Buffalo
%Jim Gerland of Buffalo picked it up from net and posted this without knowing 
%whom to credit. 
%I did some minor changes to make it LaTeXible. It is so cute that I 
%think it worth reposting.

% Usage:
%
% \bigfirstletter
% This works very well. The first letter `T' is bigger than the others. See 
% where the second line goes? Guess what? It is behind T. and also see where 
% the third line goes? guess what? It is aligned with T.

\def\bigfirstletter#1#2{{\noindent
    \setbox0\hbox{\Huge #1}\setbox1\hbox{#2}\setbox2\hbox{(}%
    \count0=\ht0\advance\count0 by\dp0\count1\baselineskip
    \advance\count0 by-\ht1\advance\count0 by\ht2
    \dimen1=.5ex\advance\count0 by\dimen1\divide\count0 by\count1
    \advance\count0 by1\dimen0\wd0
    \advance\dimen0 by.25em\dimen1=\ht0\advance\dimen1 by-\ht1
    \global\hangindent\dimen0\global\hangafter-\count0
    \hskip-\dimen0\setbox0\hbox to\dimen0{\raise-\dimen1\box0\hss}%
    \dp0=0in\ht0=0in\box0}#2}

%=============================================================================
% includeversion, excludeversion, and comment environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Version control macros. These let you define environments whose contents
% will be optionally added to or deleted from the text when you run LaTeX.
% Usage: place either of the following near the start of your file:
%     \includeversion{NAME}
%     \excludeversion{NAME}
% Here, "NAME" is any name you choose. The first one indicates that text
% between \begin{NAME} and \end{NAME} will be processed in the normal way.
% The second indicates that text between \begin{NAME} and \end{NAME} will
% be totally deleted.
% You can define environments for as many versions as you want. 
% A ``comment'' environment has already been pre-defined for you with 
% \excludeversion{comment}; you can override this using \includeversion.
%
% Example: 
%   \includeversion{abridged}\excludeversion{unabridged}
%   Text for the
%   \begin{abridged} 
%      short
%   \end{abridged}
%   \begin{unabridged}
%      long and really longwinded, opaque and boring
%   \end{unabridged}
%   version of the paper. Punctuation works correctly\begin{unabridged}
%   because sphack is used\end{unabridged}.
%   \begin{comment} This is deleted by default. \end{comment}
%
% Stephen Bellantoni 1990, loosely based on "annotation.sty" by Tom Hofmann.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begingroup
\catcode`@=11\relax%
\catcode`{=12\relax\catcode`}=12\relax%
\catcode`(=1\relax \catcode`)=2\relax%
\gdef\includeversion#1(%
  \expandafter\gdef\csname #1\endcsname%
    ()%
  \expandafter\gdef\csname end#1\endcsname%
    ()%
)%
\gdef\excludeversion#1(%
  \expandafter\gdef\csname #1\endcsname%
    (\@bsphack\catcode`{=12\relax\catcode`}=12\relax\csname #1@NOTE\endcsname)%
  \long\expandafter\gdef\csname #1@NOTE\endcsname ##1\end{#1}%
    (\csname #1END@NOTE\endcsname)%
  \expandafter\gdef\csname #1END@NOTE\endcsname%
    (\@esphack\end(#1))%
)%
\endgroup
\excludeversion{comment}
%=============================================================================
% podar@sbcs (Sunil Podar) July 14, 1986
% following commands implemented here (see the comments below for more info):
% \pmb
% \timeofday
% \verbfile
% \listing
%----------------------------------------------------------------------------
% poor man's bold. from pp. 386 of TeXbook. 1.732*0.025=0.0433 (the ratio of
% em to ex)
\newdimen\pmboffset
\pmboffset 0.025em
\def\pmb#1{\setbox0=\hbox{#1}%
 \kern-\pmboffset\copy0\kern-\wd0
 \kern 2\pmboffset\copy0\kern-\wd0
 \kern-\pmboffset\raise 1.732\pmboffset\box0 }
%----------------------------------------------------------------------------
% \timeofday is just like \today; it gives the current time of day in the form
% hh:mm as in the military style. It eats up a blank so normally one would
% say: \timeofday\  (i.e. a \<space>.
\def\timeofday{{\@tempcnta=\time \divide\@tempcnta by 60 \@tempcntb=\@tempcnta
\multiply\@tempcntb by 60 \advance\@tempcntb by -\time %@tempcntb is -ve here
\ifnum\@tempcntb < -9 \number\@tempcnta:\number-\@tempcntb
  \else\number\@tempcnta:0\number-\@tempcntb\fi}}
%----------------------------------------------------------------------------
%From: Tim Morgan <morgan@uci-icsa>
%Subject: verbatim macros
%Here are some macros which I mostly stole from the TeXbook source and
%other places.  You can say
%
%	\verbfile{filename}
%to \input all of "filename" in verbatim mode.  The end of the file is the
%only thing that gets you back out of verbatim -- no characters are special.
%\listing is the same except that each line of the file is automatically
%numbered.
%Tim
%
% Produce verbatim listings of various sorts

\def\uncatcodespecials{\def\do##1{\catcode`##1=12 } \dospecials}

\def\setupverbatim{%
    \par \tt \spaceskip=0pt	% Make sure we get fixed tt spacing
    \obeylines\uncatcodespecials\obeyspaces\verbatimdefs
}
{\catcode`\^^M=13{\catcode`\ =13\gdef\verbatimdefs{\def^^M{\ \par}\let =\ }}
  \gdef\verbatimgobble#1^^M{}}
%
% Input a file in verbatim mode.  Sometimes useful for including
% real-life examples into a paper.
\def\verbfile#1{\begingroup\setupverbatim
    \parskip=0pt plus .05\baselineskip \parindent=0pt
    \input#1 \endgroup
}

% This is the same as the above, but it adds line numbers to each
% line of the file printed.
\newcount\lineno
\def\listing#1{\lineno=0\begingroup\setupverbatim
    \parskip=0pt plus .05\baselineskip \parindent=20pt
    \everypar{\advance\lineno by 1 \llap{\the\lineno\ \ }}\input#1
    \endgroup
}

%=============================================================================
% \simge and \simle
%Newsgroups: comp.text.tex
%Subject: Re: How do I make a greater than approx (> over ~)?
%Date: 13 Nov 90 00:12:33 GMT
%References: <MAN.90Nov12143849@whizzle.stanford.edu>
%Organization: Center for Relativity, University of Texas
%
%       \simge and \simle make the "greater than about" and the "less
% than about" symbols with spacing as relations.
%
\def\simge{\mathrel{%
   \rlap{\raise 0.511ex \hbox{$>$}}{\lower 0.511ex \hbox{$\sim$}}}}
\def\simle{\mathrel{
   \rlap{\raise 0.511ex \hbox{$<$}}{\lower 0.511ex \hbox{$\sim$}}}}
%=============================================================================
%%% \spreadtitle  spreads the letters in a title (all on one line) out
%%%               and allows the spacing between words to be given
%     #1 = the width of the box in which the letters are to fit
%     #2 = the ratio of the width between words to the width between letters
%     #3 = the text
%
%Examples follow.
% this shows that no extraneous spaces have been introduced
%   YYY\spreadtitle{3.truein}{2.5}{Now is the time!}YYY

\def\LETBLANK:{\let\letblank= }\LETBLANK: 
\def\Hss#1{\hskip 0pt plus #1fil minus #1fil}

\def\spreadtitle#1#2#3{\def\START{1}\def\SPREAD{#2}%
                       \expandafter\geteachchar#3\end%
                       \hbox to #1{\unhbox0}}
\def\geteachchar{\futurelet\nextletchar\nextdefchar}
\def\nextdefchar#1{%
    \ifx #1\end \let\next=\relax  % the title is finished
    \else
      \ifnum \START=1 \setbox0=\hbox{#1}\def\START{0}% this is the first
                                                     % character of the title
      \else % this is not the first character of the title
        \ifx \nextletchar\letblank
          \setbox0=\hbox{\unhbox0\Hss\SPREAD{}#1}% a word has ended
        \else
          \setbox0=\hbox{\unhbox0\Hss1{}#1}% we are in the middle of a word
        \fi
      \fi \let\next=\geteachchar
    \fi \next}

%=============================================================================
% RANGECITE DOCUMENT-STYLE OPTION FOR ANY STYLE WITH NUMERIC CITATIONS
%
% This redefines the LaTex \@cite macro to gather consecutive citation numbers
% i,i+1,...,j into a range i-j
% 
% Nachum Dershowitz (nachum@cs.uiuc.edu)
% Edward M. Reingold (reingold@cs.uiuc.edu)
%
% These macros are in the public domain.  You may use them and copy them at
% will, provided you retain the authorship information.  We wrote these for
% temporary use in a single paper, so use them at your own risk!
%
% Written 12 Apr 1990
%
% Professor Edward M. Reingold                  reingold@cs.uiuc.edu
% Department of Computer Science                (217) 333-6733
% University of Illinois at Urbana-Champaign
% 1304 W. Springfield Ave.
% Urbana, IL 61801-2987  USA
%
%
\newif\if@first%
\newcounter{@@@first}%
\newcounter{@@@state}%
%
%  A simple four-state finite automaton:
%        State 0:  No references in current range
%        State 1:  One reference in current range
%        State 2:  Two references in current range
%        State 3:  More than two references in current range
%
\newcounter{@@@next}%
\newcounter{@@@cur}%
\newcounter{@@@curt}%
\newcommand{\b@@@ENDLIST}{9999}%
\def\@citex[#1]#2{%
  \if@filesw\immediate\write\@auxout{\string\citation{#2}}\fi%
  \def\@citea{}%
  \@cite{%
     \@firsttrue%
     \setcounter{@@@state}{0}%
     \@for\@citeb:=#2,@@ENDLIST\do{%
         \@ifundefined{b@\@citeb}%
            {{\bf ?}%
             \@warning{Citation `\@citeb' on page \thepage \space undefined}}%
%        else%
            {\setcounter{@@@next}{\csname b@\@citeb\endcsname}%
             \ifcase\the@@@state%
%                  state 0:
               \setcounter{@@@state}{1}%
             \or%  state 1:
               \ifnum\value{@@@next}=\value{@@@curt}%
                  \setcounter{@@@state}{2}%
                  \setcounter{@@@first}{\value{@@@cur}}%
               \else%
                  \if@first{}\else{,\ }\fi%
                  \the@@@cur%
                  \@firstfalse%
               \fi%
             \or%  state 2:
               \ifnum\value{@@@next}=\value{@@@curt}%
                  \setcounter{@@@state}{3}%
               \else%
                  \setcounter{@@@state}{1}%
                  \if@first{}\else{,\ }\fi%
                  \the@@@first,\ \the@@@cur%
                  \@firstfalse%
               \fi%
             \or%  state 3:
               \ifnum\value{@@@next}=\value{@@@curt}%
               \else%
                  \setcounter{@@@state}{1}%
                  \if@first{}\else{,\ }\fi%
                  \the@@@first--\the@@@cur% T.S. changed - to --
                  \@firstfalse%
               \fi%
            \fi%
         \setcounter{@@@cur}{\value{@@@next}}%
         \setcounter{@@@curt}{\value{@@@cur}}%
         \addtocounter{@@@curt}{1}}}}%
  {#1}}%

%=============================================================================
% shadowbox and doublebox : extract from fancybox.sty
%%
%% COPYRIGHT 1992, by Timothy Van Zandt, tvz@Princeton.EDU
%%
%% DESCRIPTION:
%%   fancybox.sty is a LaTeX style option, consisting of:
%%   * Variants of \fbox: \shadowbox, \doublebox, \ovalbox, \Ovalbox.
%%   * Various tricks for using box macros.
%%   * Extensive documentation about how to use box macros.
%%   * Flexible verbatim macros.
%%

\newbox\@tempfbox
\@ifundefined{@tempdimc}{\newdimen\@tempdimc}{}
\@ifundefined{@tempdimd}{\newdimen\@tempdimd}{}

%% \shadowbox

\def\shadowsize{4pt}%

\long\def\shadowbox#1{%
  \setbox\@tempboxa\hbox{\fbox{{#1}}}%
  \leavevmode\vbox{%
    \offinterlineskip
    \hbox{\copy\@tempboxa\lower\shadowsize\hbox{%
      \vrule \@height\ht\@tempboxa \@depth\dp\@tempboxa \@width\shadowsize}}%
    \vskip-\shadowsize
    \moveright\shadowsize\vbox{%
      \hrule \@width\wd\@tempboxa \@height\shadowsize}}}

% \doublebox

\long\def\doublebox#1{%
  \begingroup
    \setbox\@tempboxa\hbox{{#1}}%
    \fboxrule=.75\fboxrule
    \setbox\@tempboxa\hbox{\fbox{\box\@tempboxa}}%
    \fboxrule=2\fboxrule
    \fboxsep=\fboxrule
    \advance\fboxsep .5pt
    \fbox{\box\@tempboxa}%
  \endgroup}
%==================================================================
%From: asnd@msr.triumf.ca (Donald Arseneau)
%Newsgroups: comp.text.tex
%Subject: Re: Is enough space left on the page?
%Date: 24 Nov 1993 13:07 PST
%Organization: TRIUMF: Tri-University Meson Facility
% >I'm looking for some way to ensure that a certain amount of space is
% >left on a page before doing certain things.
% ...
% Finally, there is another method that works very well, as long as you
% use it between paragraphs: (I.e., not in a \vadjust{}.)
%    Donald Arseneau                         asnd@reg.triumf.ca
%
\def\need#1{\par \penalty-100 \begingroup % preserve \dimen@
  \dimen@\pagegoal \advance\dimen@-\pagetotal % space left
  \ifdim #1>\dimen@ \vfil \eject \fi
  \endgroup}
% You can eliminate the \vfil to get flush-bottom but possibly stretched pages.
%===================================================
%Newsgroups: comp.text.tex
%From: imc@comlab.ox.ac.uk (Ian Collier)
%Subject: Re: Three dots symbol for "Therefore"
%Message-ID: <4380.imc@uk.ac.ox.prg>
%Organization: Oxford University Computing Laboratory
%Date: Fri, 10 Dec 1993 12:38:10 GMT
%In article <9DEC199316584482@reg.triumf.ca>,
% asnd@reg.triumf.ca (Donald Arseneau) wrote:
%|\def\therefore{.\dot{~}.}
%So now all we need is some spacing...  :-)

\def\therefore{\mathrel{.\dot{~}.\mskip1mu}}
%===================================================
% end of msmac.sty
